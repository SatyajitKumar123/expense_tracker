{% extends 'expenses/base.html' %}

{% block content %}
<h2>Expenses</h2>

<section class="filter-section">
    <form method="get" class="filter-form">
        <div>
            <label for="category">Category:</label>
            <select name="category" id="category">
                <option value="">All</option>
                {% for cat in categories %}
                    <option value="{{ cat.id }}" {% if request.GET.category == cat.id|stringformat:"s" %}selected{% endif %}>
                        {{ cat.name }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="start_date">From date:</label>
            <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date }}">
        </div>

        <div>
            <label for="end_date">To date:</label>
            <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date }}">
        </div>

        <button type="submit">Filter</button>
        <a href="{% url 'expenses:expense_list' %}" class="btn-secondary">Reset</a>
    </form>
</section>

<section class="summary-section">
    <p><strong>Total Amount (current filter):</strong> {{ total_amount }}</p>
</section>

<table class="table">
    <thead>
        <tr>
            <th>Date</th>
            <th>Category</th>
            <th>Description</th>
            <th>Payment Method</th>
            <th class="text-right">Amount</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% if expenses %}
            {% for expense in expenses %}
                <tr>
                    <td>{{ expense.date }}</td>
                    <td>{{ expense.category.name }}</td>
                    <td>{{ expense.description|default:"-" }}</td>
                    <td>{{ expense.get_payment_method_display }}</td>
                    <td class="text-right">{{ expense.amount }}</td>
                    <td>
                        <a href="{% url 'expenses:expense_update' expense.pk %}">Edit</a> |
                        <a href="{% url 'expenses:expense_delete' expense.pk %}">Delete</a>
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <tr><td colspan="6">No expenses found.</td></tr>
        {% endif %}
    </tbody>
</table>

{% if is_paginated %}
<div class="pagination">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.start_date %}&start_date={{ request.GET.start_date }}{% endif %}{% if request.GET.end_date %}&end_date={{ request.GET.end_date }}{% endif %}">&laquo; Prev</a>
    {% endif %}

    <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>

    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.start_date %}&start_date={{ request.GET.start_date }}{% endif %}{% if request.GET.end_date %}&end_date={{ request.GET.end_date }}{% endif %}">Next &raquo;</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}
